worker_processes  auto;

events {
    worker_connections  1024;
}

rtmp {
    server {
        listen      1935;
        chunk_size  4096;

        application live {
            live                 on;
            record               off;
            on_publish           http://localhost:5015/rtmp/auth;
            on_publish_done      http://localhost:5015/rtmp/done;
            allow publish all;
            allow play    all;
            hls                 on;
            hls_path            /tmp/hls;
            hls_fragment        2s;
            hls_playlist_length 8s;
            hls_type            live;
            hls_cleanup         on;
        }
    }
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name _;

        location / { return 403; }

        location /hls/ {
            root /tmp;
            add_header Cache-Control "no-cache, no-store, must-revalidate" always;
            add_header Pragma        "no-cache" always;
            add_header Expires       0 always;
            add_header Access-Control-Allow-Origin  * always;
            add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
            add_header Access-Control-Allow-Headers "Range" always;
        }

        location = /favicon.ico { return 204; }
    }
}